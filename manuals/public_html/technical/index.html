<!DOCTYPE html>
<html>
  <head>
    <title>Easy Design - Technical Manual</title>
    <link rel="stylesheet" href="style.css">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <script src="jquery-2.0.3.min.js"></script>
    <script src="script.js"></script>
  </head>
  <body>
    <div id="container">
      <div class="header">
        <h1>Easy Design: Technical Manual</h1>
        <h3>David Hulme - dh7g10@soton.ac.uk</h3>
        
        <p>This technical manual will cover the system architecture of Easy Design,
         explain which features from the specification have been implemented,
         and the tools, technologies and techniques that have been used throughout
         development.</p>
      </div>
      
      <div id="contents" class="header">
        <h2>Contents</h2>
      </div>
      
      <div class="content">
        <h2>Overview</h2>
        <h3>Introduction</h3>
        <p>Easy Design is a new startup company launching a service to enable
          customers such as charities and organisations to quickly produce well
          designed logos, posters and flyers based on user generated content.</p>

        <p>The site will make money through advertising.</p>
      
        <h3>Implemented User Stories</h3>
        <h4>1. Upload content</h4>
        <p>Content creators upload their created design templates to the site. They
          must first register with the site before being able to upload content.</p>
        
        <h4>2. Browsing content</h4>
        <p>Customers can search and browse the site to discover the content
          they are looking for. They can browse by content type (e.g. logos, posters, flyers)
          or by search term.</p>
        <p>Newly uploaded templates, those with a high number of downloads
          and those with high ratings will be displayed on the home page.</p>
        
        <h4>3. Downloading content</h4>
        <p>When a customer finds a design they like, they can download a high quality
          version of the design which they can then edit before printing out or
          uploading to their own web site.</p>
        <p>A customer must register with the site to be able to download the design.</p>
        
        <h4>4. Reviewing content</h4>
        <p>When a customer has downloaded a design, they gain permission to rate
          and review it. The system can then recommend additional
          content to customer based upon this information.</p>
        
        <h4>5. System Management</h4>
        <p>Administrators are able to do additional actions to normal users. They
          can edit and delete templates as well as add and edit categories.</p>
      </div>

      <div class="content">
        <h2>Architecture and Design</h2>
        
        <h3>Entity Relationship Diagram</h3>
        <p>An Entity Relationship Diagram is shown below based on the final
          schema of the database. It shows the different tables in the database
          and their foreign key relations.</p>
        <img src="erd.png" alt="Entity Relationship Diagram">
        
        <h3>System Structure</h3>
        <p>The system is structured using the Model–view–controller (MVC) software
          pattern. The diagram below shows the different MVC components.</p>
        <img src="structure.png" alt="System Structure">
      </div>

      <div class="content">
        <h2>Implemented Features</h2>
        <p>Below are a list of features that have been implemented in Easy Design,
          along with a brief explanation and accompanying evidence.</p>
        
        <h3>Template catalogue</h3>
        <blockquote>
          <p>Items (eg products) are stored in a dynamic and editable hierarchy, 
            which can easily be browsed and searched</p>
        </blockquote>
        
        <p>Each template in the database is assigned a category. Users can browse
          templates by category, or search for a template by name or description.</p>
        
        <p>Searching is provided using <a href="http://pat.github.io/thinking-sphinx/">Thinking Sphinx</a>,
          a Ruby library that connects to the <a href="http://sphinxsearch.com/">Sphinx</a>
          search server.</p>
        
        <p>Thinking Sphinx provides a <code>search</code> method that can be used
          on the database models. An indexing file, <code>/app/indices/template_index.rb</code> (shown below), is required so
          Sphinx knows what properties of the models to index.</p>
        
        <pre>
ThinkingSphinx::Index.define <span class="symbol">:template</span>, <span class="symbol">:with</span> => <span class="symbol">:active_record</span> <span class="keyword">do</span>
  <span class="comment"># Fields</span>
  <strong>indexes</strong> title, <span class="symbol">:sortable</span> => <span class="keyword">true</span>
  <strong>indexes</strong> description
  
  <span class="comment"># Attributes</span>
  <strong>has</strong> created_at, updated_at
<span class="keyword">end</span>
        </pre>
          
          
        <p>Administrators can add or edit categories by visiting <code>/categories</code>.
          The code snippet below shows the <code>create</code> method in
          <code>/app/controllers/categories_controller.rb</code>.</p>
        
        <pre>
<span class="keyword">def</span> create
  <span class="instance-var">@category</span> = <strong>Category</strong>.new(category_params)
  <span class="instance-var">@category</span>.save

  <strong>redirect_to</strong> '/categories'
<span class="keyword">end</span>
        </pre>
        
        
        <h3>Recommendation System</h3>
        <blockquote>
          <p>a personalised dynamic recommender system</p>
        </blockquote>
        
        <p>Easy Design provides a recommendation system for users. A list of
          possible recommendations are shown on the home page. The algorithm
          works in three steps:</p>
        
        <ol>
          <li>Get all templates the user has downloaded</li>
          <li>For each template, get other users who have downloaded that template</li>
          <li>For each of these users, get all other templates they have downloaded</li>
          <li>Recommend those templates to the user</li>
        </ol>
        
        <p>The full source for the algorithm can be found in the <code>home</code>
          method in <code>/app/controllers/pages_controller.rb</code>.</p>
          
        
        
        <h3>Template management</h3>
        <blockquote>
          <p>Display and update work items involving multiple users and roles</p>
        </blockquote>
        
        <p>A list of all templates can be found through <code>/discover</code> or
          <code>/templates</code>. Individual templates can then be viewed through
          the <code>/templates/{template_id}</code> endpoint. Administrators can
          update or delete a template using the provided buttons.</p>
        
        <figure>
          <img src="edit-template.png" alt="Edit template screenshot" class="full-width">
          <figcaption>Screenshot showing a template being edited by an administrator</figcaption>
        </figure>
        
        
        <h3>Review System</h3>
        <blockquote>
          <p>Users can post comments or messages to selected roles, view them, rate, filter and sort them appropriately.</p>
        </blockquote>
        
        <p>Users can review a template and give it a rating. They are only able
          to post one review per template.</p>
        
        <p>The <code>create</code> review method from <code>/app/controllers/reviews_controller.rb</code>
          is shown below.</p>
        
        <pre>
<span class="keyword">def</span> create
  <span class="comment"># Check user hasn't already reviewed the template</span>
  <span class="instance-var">@template</span> = <strong>Template</strong>.find(params[<span class="symbol">:template_id</span>])
  <span class="keyword">if</span> <span class="instance-var">@template</span>.has_user_reviewed? current_user
    <span class="keyword">return</span>
  <span class="keyword">end</span>

  <span class="instance-var">@review</span> = <strong>Review</strong>.new(review_params)
  <span class="instance-var">@review</span>.user = current_user
  <span class="instance-var">@review</span>.save

  <strong>respond_with</strong> <span class="instance-var">@review</span>
<span class="keyword">end</span>
        </pre>
        
        
        
        
        <h3>Template Image Generation</h3>
        <blockquote>
          <p>Dynamic generation of images (eg visualisation of business objects or statistics) and multimedia manipulation (eg scaling or compression).</p>
        </blockquote>
        
        <p>For each template image uploaded to Easy Design, the system generates
          a preview image and a smaller thumbnail image. The preview image is shown
          on the template page (e.g. <code>/templates/1</code>) and the thumbnail
          is shown on the discover page. The size of the generated images can be
          set in <code>/config/application.rb</code>.</p>
        
        <p>The system uses <a href="http://www.imagemagick.org/script/index.php">ImageMagick</a>
          to generate the preview and thumbnail images. The snippet from
          the <code>create</code> method in <code>/app/controllers/templates_controller.rb</code>
          below shows the image generation code.</p>
        
        <pre>
<span class="comment"># Upload image file
# From http://guides.rubyonrails.org/form_helpers.html#uploading-files</span>
uploaded_io = params[<span class="symbol">:template</span>][<span class="symbol">:image</span>]
<span class="instance-var">@template</span>.filename = SecureRandom.uuid
<strong>File</strong>.open(Rails.root.join('public', 'uploads', <span class="instance-var">@template</span>.filename), 'wb') <span class="keyword">do</span> |file|
  <span class="comment"># Create full size file, preview and thumbnail versions</span>
  file.write(uploaded_io.read)
  <strong>system</strong> "convert #{file.path} -resize #{Rails.configuration.preview_size} #{file.path}#{Rails.configuration.preview_extension}"
  <strong>system</strong> "convert #{file.path} -resize #{Rails.configuration.thumbnail_size} #{file.path}#{Rails.configuration.thumbnail_extension}"
<span class="keyword">end</span>
        </pre>
      

        <h3>Data Import</h3>
        <blockquote>
          <p>Inclusion of live data from external sources (eg other web sites) via protocols such as RSS, using XML formatted data</p>
        </blockquote>
        <p>Not currently implemented</p>

        <h3>Data Export</h3>
        <blockquote>
          <p>Export of internally stored business data for use in external sites, using XML formatted data.</p>
        </blockquote>

        <p>Easy Design has a public ATOM feed of all the templates in the system.
          This would allow other developers to make use of the templates uploaded
          to Easy Design and include them as part of their own web applications.</p>
        
        <p>The <code>feed</code> method from <code>/app/controllers/templates_controller.rb</code>,
          shown below, demonstrates this.</p>
        
        <pre>
<span class="comment"># From http://stackoverflow.com/questions/3951235/how-do-i-make-an-rss-atom-feed-in-rails-3</span>
<span class="keyword">def</span> feed
  <span class="instance-var">@title</span> = 'Templates'
  <span class="instance-var">@templates</span> = <strong>Template</strong>.order('created_at DESC')
  <span class="instance-var">@updated</span> = <span class="instance-var">@templates</span>.first.created_at <span class="keyword">unless</span> <span class="instance-var">@templates</span>.empty?

  <strong>respond_to</strong> <span class="keyword">do</span> |format|
    format.atom { <strong>render</strong> <span class="symbol">:layout</span> => <span class="keyword">false</span>}

    format.rss { <strong>redirect_to</strong> feed_path(<span class="symbol">:format</span> => <span class="symbol">:atom</span>), <span class="symbol">:status</span> => <span class="symbol">:moved_permanently</span> }
  <span class="keyword">end</span>
<span class="keyword">end</span>
        </pre>
          
        
        <h3>Professional Feel</h3>
        <blockquote>
          <p>Professional appearance with logo, master pages, style sheets, site menus, breadcrumbs, login status and multi-part forms.</p>
        </blockquote>
        <p><a href="http://getbootstrap.com/">Twitter Bootstrap</a> has been used
          throughout the site to give a consistent and professional look and feel.
          Individual stylesheets have been used for the different sections of the
          site, to prevent the browser requesting unnecessary styles.</p>
        
        <p>The site menu is displayed in the top navigation bar, and the login
          status to the right of the navigation bar. Breadcrumbs are not required
          because the only nested navigation occurs when viewing a template.</p>
        
        <p><code>multipart/form-data</code> was used when in the upload form. The code
          snippet below shows the HTML that is generated by the form found in 
          <code>/app/views/templates/new.html.erb</code>.</p>
        
        <pre>
&lt;form accept-charset="UTF-8" action="/templates" enctype="multipart/form-data" method="post"&gt;
        </pre>
      </div>

      <div class="content">
        <h2>Tools, Technologies and Techniques</h2>
        
        <h3>Development environment</h3>
        <blockquote>
          <p>Professional IDE, including WYSIWYG or syntax-highlighting HTML editor, database administration, and on-the fly display and debugging of web pages and code.</p>
          
          <p>Automated object relational mapping, database / schema generation.</p>
          
          <p>Form &amp; markup generation.</p>
        </blockquote>
        
        <p>The <a href="https://netbeans.org/">NetBeans IDE</a> with the
          <a href="http://wiki.netbeans.org/Ruby">Ruby plugin</a> was used to
          develop Easy Design. The screenshot below shows the syntax-highlighting
          for both HTML and Ruby syntax.</p>
        
        <figure>
          <img src="netbeans.png" alt="NetBeans IDE" class="full-width">
          <figcaption>
            NetBeans IDE showing syntax highlighting<br>
            From <code>/app/views/templates/new.html.erb</code>
          </figcaption>
        </figure>
        
        <p>Database administration was provided through the high level <a href="http://guides.rubyonrails.org/active_record_querying.html">
          Active Record Query Interface</a>, and at a lower level through 
          <a href="http://www.heidisql.com/">HeidiSQL</a>. Active Record also
          provided object relational mapping and database/schema generation.</p>
        
        <p>Easy Design was tested in the <a href="https://www.google.com/intl/en/chrome/browser/">Google Chrome</a> 31
          web browser. Debugging was provided through the <a href="https://developers.google.com/chrome-developer-tools/">Chrome Developer tools</a>
          and debugging messages provided by Rails.</p>
        
        <p>The screenshot of the NetBeans IDE also shows form markup generation.
          There was no need to manually write the HTML for the form elements.
          For example, <code>&lt;%= form_for :template, url: templates_path do |f| &gt;></code>
          produces <code>&lt;form accept-charset="UTF-8" action="/templates" enctype="multipart/form-data" method="post"&gt;</code>.</p>
          
          
        <h3>External libraries</h3>
        <blockquote>
          <p>External libraries and web services.</p>
        </blockquote>
        
        <p>The following external libraries were used in the project:</p>
        <ul>
          <li>Server side
            <ul>
              <li><a href="http://www.imagemagick.org/script/index.php">ImageMagick</a> - Image manipulation</li>
              <li><a href="http://pat.github.io/thinking-sphinx/">Thinking Sphinx</a> and <a href="http://sphinxsearch.com/">Sphinx</a> - Search engine</li>
              <li><a href="https://github.com/plataformatec/devise">devise</a> - User authentication</li>
              <li><a href="http://www.ruby-doc.org/stdlib-1.9.3/libdoc/securerandom/rdoc/SecureRandom.html">Secure Random</a> - Generating random image file names</li>
            </ul>
          </li>
          <li>Client side
            <ul>
              <li><a href="http://jquery.com/">jQuery</a> - To make interaction with the DOM easier</li>
              <li><a href="http://getbootstrap.com/">Twitter Bootstrap</a> - Provide a look and feel</li>
              <li><a href="http://bootboxjs.com/">Bootbox.js</a> - Make using Twitter Bootstrap modals easier</li>
            </ul>
          </li>
        </ul>
        
        
        <h3>Testing and Accessibility</h3>
        <blockquote>
          <p>Automated unit testing. Scalability and security testing. Accessibility & (X)HTML validation.</p>
        </blockquote>
        
        <p>First bit not done.</p>
        
        <p>All HTML and CSS pages were validated through the <a href="http://validator.w3.org/">W3C Markup Validation Service</a>.</p>
        
        
        
        <h3>Architectural Patterns</h3>
        <blockquote>
          <p>Clear separation of layers or tiers (eg MVC); maintainable code. Enterprise / web architecture patterns.</p>
        </blockquote>
        
        <p>Through using Rails, the Model-view-controller (MVC) software pattern was used. I strove
          to write well-designed code that would be readable, extensible and
          maintainable.</p>
        
        
        <h3>Advanced Web Controls</h3>
        <blockquote>
          <p>Web controls or widgets eg rich text editor.</p>
          <p>Automated validation of entered data.</p>
        </blockquote>
        
        <p>Not currently implemented.</p>
        
        <h3>User authentication</h3>
        <blockquote>
          <p>Sessions or cookies. Secure access, authentication, roles.</p>
        </blockquote>
        
        <p><a href="https://github.com/plataformatec/devise">devise</a> was used
          to handle sessions and user authentication. An <code>admin</code> field
          was added to the User model to store if the user was an administrator.</p>
        
        <h3>Data Integrity</h3>
        <blockquote>
          <p>Data integrity and consistency. Database constraints, triggers, referential integrity, prepared statements, transactions. BLOBs. Database exception handling.</p>
        </blockquote>
        
        <p>Active Record maintained data integrity and managed all interactions
          with the database.</p>
      </div>
      
      <div class="content">
        <h2>Code overview</h2>
        Table of files and lines of code
      </div>
      
      <div class="content">
        <h2>Evaluation</h2>
      </div>
    </div>
  </body>
</html>
