<!DOCTYPE html>
<html>
  <head>
    <title>Easy Design - Technical Manual</title>
    <link rel="stylesheet" href="style.css">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>
  <body>
    <div id="container">
      <div id="header" class="content">
        <h1>Easy Design: Technical Manual</h1>
        <h3>David Hulme - dh7g10@soton.ac.uk</h3>
      </div>

      <div id="design" class="content">
        <h2>Architecture and Design</h2>
        
        <h3>Entity Relationship Diagram</h3>
        <p>An Entity Relationship Diagram is shown below based on the final
          schema of the database. It shows the different tables in the database
          and their foreign key relations.</p>
        <img src="erd.png" alt="Entity Relationship Diagram">
        
        <h3>System Structure</h3>
        <p>The system is structured using the Model–view–controller (MVC) software
          pattern. The diagram below shows the different MVC components.</p>
        <img src="structure.png" alt="System Structure">
      </div>

      <div class="content">
        <h2>Implemented Features</h2>
        <p>Below are a list of features that have been implemented in Easy Design,
          along with a brief explanation and accompanying evidence.</p>
        
        <h3>Template catalogue</h3>
        <blockquote>
          <p>Items (eg products) are stored in a dynamic and editable hierarchy, 
            which can easily be browsed and searched</p>
        </blockquote>
        
        <p>Each template in the database is assigned a category. Users can browse
          templates by category, or search for a template by name or description.</p>
        
        <p>Searching is provided using <a href="http://pat.github.io/thinking-sphinx/">Thinking Sphinx</a>,
          a Ruby library that connects to the <a href="http://sphinxsearch.com/">Sphinx</a>
          search server.</p>
        
        <p>Thinking Sphinx provides a <code>search</code> method that can be used
          on the database models. An indexing file, <code>/app/indices/template_index.rb</code> (shown below), is required so
          Sphinx knows what properties of the models to index.</p>
        
        <pre>
ThinkingSphinx::Index.define <span class="symbol">:template</span>, <span class="symbol">:with</span> => <span class="symbol">:active_record</span> <span class="keyword">do</span>
  <span class="comment"># Fields</span>
  <strong>indexes</strong> title, <span class="symbol">:sortable</span> => <span class="keyword">true</span>
  <strong>indexes</strong> description
  
  <span class="comment"># Attributes</span>
  <strong>has</strong> created_at, updated_at
<span class="keyword">end</span>
        </pre>
          
          
        <p>Administrators can add or edit categories by visiting <code>/categories</code>.
          The code snippet below shows the <code>create</code> method in
          <code>/app/controllers/categories_controller.rb</code>.</p>
        
        <pre>
<span class="keyword">def</span> create
  <span class="instance-var">@category</span> = <strong>Category</strong>.new(category_params)
  <span class="instance-var">@category</span>.save

  <strong>redirect_to</strong> '/categories'
<span class="keyword">end</span>
        </pre>
        
        
        <h3>Recommendation System</h3>
        <blockquote>
          <p>a personalised dynamic recommender system</p>
        </blockquote>
        
        <p>Easy Design provides a recommendation system for users. A list of
          possible recommendations are shown on the home page. The algorithm
          works in three steps:</p>
        
        <ol>
          <li>Get all templates the user has downloaded</li>
          <li>For each template, get other users who have downloaded that template</li>
          <li>For each of these users, get all other templates they have downloaded</li>
          <li>Recommend those templates to the user</li>
        </ol>
        
        <p>The full source for the algorithm can be found in the <code>home</code>
          method in <code>/app/controllers/pages_controller.rb</code>.</p>
          
        
        
        <h3>Template management</h3>
        <blockquote>
          <p>Display and update work items involving multiple users and roles</p>
        </blockquote>
        
        <p>A list of all templates can be found through <code>/discover</code> or
          <code>/templates</code>. Individual templates can then be viewed through
          the <code>/templates/{template_id}</code> endpoint. Administrators can
          update or delete a template using the provided buttons.</p>
        
        <figure>
          <img src="edit-template.png" alt="Edit template screenshot" class="full-width">
          <figcaption>Screenshot showing a template being edited by an administrator</figcaption>
        </figure>
        
        
        <h3>Review System</h3>
        <blockquote>
          <p>Users can post comments or messages to selected roles, view them, rate, filter and sort them appropriately.</p>
        </blockquote>
        
        <p>Users can review a template and give it a rating. They are only able
          to post one review per template.</p>
        
        <p>The <code>create</code> review method from <code>/app/controllers/reviews_controller.rb</code>
          is shown below.</p>
        
        <pre>
<span class="keyword">def</span> create
  <span class="comment"># Check user hasn't already reviewed the template</span>
  <span class="instance-var">@template</span> = <strong>Template</strong>.find(params[<span class="symbol">:template_id</span>])
  <span class="keyword">if</span> <span class="instance-var">@template</span>.has_user_reviewed? current_user
    <span class="keyword">return</span>
  <span class="keyword">end</span>

  <span class="instance-var">@review</span> = <strong>Review</strong>.new(review_params)
  <span class="instance-var">@review</span>.user = current_user
  <span class="instance-var">@review</span>.save

  <strong>respond_with</strong> <span class="instance-var">@review</span>
<span class="keyword">end</span>
        </pre>
        
        
        
        
        <h3>Template Image Generation</h3>
        <blockquote>
          <p>Dynamic generation of images (eg visualisation of business objects or statistics) and multimedia manipulation (eg scaling or compression).</p>
        </blockquote>
        
        <p>For each template image uploaded to Easy Design, the system generates
          a preview image and a smaller thumbnail image. The preview image is shown
          on the template page (e.g. <code>/templates/1</code>) and the thumbnail
          is shown on the discover page. The size of the generated images can be
          set in <code>/config/application.rb</code>.</p>
        
        <p>The system uses <a href="http://www.imagemagick.org/script/index.php">ImageMagick</a>
          to generate the preview and thumbnail images. The snippet from
          the <code>create</code> method in <code>/app/controllers/templates_controller.rb</code>
          below shows the image generation code.</p>
        
        <pre>
<span class="comment"># Upload image file
# From http://guides.rubyonrails.org/form_helpers.html#uploading-files</span>
uploaded_io = params[<span class="symbol">:template</span>][<span class="symbol">:image</span>]
<span class="instance-var">@template</span>.filename = SecureRandom.uuid
<strong>File</strong>.open(Rails.root.join('public', 'uploads', <span class="instance-var">@template</span>.filename), 'wb') <span class="keyword">do</span> |file|
  <span class="comment"># Create full size file, preview and thumbnail versions</span>
  file.write(uploaded_io.read)
  <strong>system</strong> "convert #{file.path} -resize #{Rails.configuration.preview_size} #{file.path}#{Rails.configuration.preview_extension}"
  <strong>system</strong> "convert #{file.path} -resize #{Rails.configuration.thumbnail_size} #{file.path}#{Rails.configuration.thumbnail_extension}"
<span class="keyword">end</span>
        </pre>
      

        <h3>Data Import</h3>
        <blockquote>
          <p>Inclusion of live data from external sources (eg other web sites) via protocols such as RSS, using XML formatted data</p>
        </blockquote>
        <p>Not currently implemented</p>

        <h3>Data Export</h3>
        <blockquote>
          <p>Export of internally stored business data for use in external sites, using XML formatted data.</p>
        </blockquote>

        <p>Easy Design has a public ATOM feed of all the templates in the system.
          This would allow other developers to make use of the templates uploaded
          to Easy Design and include them as part of their own web applications.</p>
        
        <p>The <code>feed</code> method from <code>/app/controllers/templates_controller.rb</code>,
          shown below, demonstrates this.</p>
        
        <pre>
<span class="comment"># From http://stackoverflow.com/questions/3951235/how-do-i-make-an-rss-atom-feed-in-rails-3</span>
<span class="keyword">def</span> feed
  <span class="instance-var">@title</span> = 'Templates'
  <span class="instance-var">@templates</span> = <strong>Template</strong>.order('created_at DESC')
  <span class="instance-var">@updated</span> = <span class="instance-var">@templates</span>.first.created_at <span class="keyword">unless</span> <span class="instance-var">@templates</span>.empty?

  <strong>respond_to</strong> <span class="keyword">do</span> |format|
    format.atom { <strong>render</strong> <span class="symbol">:layout</span> => <span class="keyword">false</span>}

    format.rss { <strong>redirect_to</strong> feed_path(<span class="symbol">:format</span> => <span class="symbol">:atom</span>), <span class="symbol">:status</span> => <span class="symbol">:moved_permanently</span> }
  <span class="keyword">end</span>
<span class="keyword">end</span>
        </pre>
          
        
        <h3>Professional Feel</h3>
        <blockquote>
          <p>Professional appearance with logo, master pages, style sheets, site menus, breadcrumbs, login status and multi-part forms.</p>
        </blockquote>
        <p><a href="http://getbootstrap.com/">Twitter Bootstrap</a> has been used
          throughout the site to give a consistent and professional look and feel.
          Individual stylesheets 
      </div>

      <div class="content">
        <h2>Tools, Technologies and Techniques</h2>
      </div>
    </div>
  </body>
</html>
